<!DOCTYPE html>
{% load socialaccount %}
{% providers_media_js %}
{% load static %}

<html>

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Travel</title>
    <link
      rel="stylesheet"
      href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css'
    />
    <link rel="stylesheet" href="{% static 'css/search.css' %}"/>
  </head>
  <body>
    <header>
      <a href="#" class="logo">travel <span>.</span></a>
      <nav class="navbar">
        <ul>
          <li><a data-scroll="home" href="#home" class="active">홈</a></li>
          <li><a data-scroll="search" href="#search">검색</a></li>
          <li><a data-scroll="mypage" href="#mypage">마이페이지</a></li>
        </ul>
      </nav>
      <div class="fas fa-bars"></div>
    </header>

    <form id="loginFrm" method="POST">
      {%csrf_token%}
      <section class="home" id="home">
        <div class="video">
          <video src="img/Plane.mp4" loop muted autoplay></video>
        </div>
        <div class="form-container">
          <form action="">
            <h3>로그인</h3>
            <span>Email</span>
            <input type="text" placeholder="이메일" name="userid"/>
            <span>비밀번호</span>
            <input type="password" placeholder="비밀번호" name="password"/>

            <div class="intro-button">
              <a class="btn btn-primary" id="loginBtn" >로그인</a>
              <a class="btn btn-primary" href="../signupForm" >회원가입</a>


              <a href="/accounts/login">회원가입</a>
              {% if user.is_authenticated %}
              <a href="/accounts/logout">구글로 로그인</a>
              {{user.username}}님이 로그인 중
              {% else %}
              <a href="{% provider_login_url 'google' %}">구글 로그인</a>
              로그인 해야함
              {% endif %}


            </div>
          </form>
        </div>
      </section>
    </form>

<!--    <script src="js/index.js"></script>-->
    <script
  src="https://code.jquery.com/jquery-3.6.0.js"
  integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
  crossorigin="anonymous"></script>

  <script>
    $(document).ready(function() {
      $("#password").keydown(function(key) {
        if (key.keyCode == 13) {
         $("#loginBtn").click()
        }
      });

      $("#loginBtn").click(function() {
        var formData = $('#loginFrm').serialize();
        $.ajax({
            cache : false,
            url : "{% url 'loginCheck' %}" ,
            type : 'POST',
            data : formData,
            success : function(data){
                var result = data['result']
                var login = data['login']
                if (login=='Y') {
                   $("#loginFrm").attr('action', "{% url 'recommend' %}").submit()
                }else{
                   alert(result);
                }
            },
            error : function(xhr,status,)
            {
                alert("로그인 실패");
            },
        });
      })
    })
  </script>
  </body>
</html>
